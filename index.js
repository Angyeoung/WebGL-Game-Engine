var s=class o{x;y;z;constructor(t,e,r){this.x=t,this.y=e,this.z=r}static get zero(){return new o(0,0,0)}static get one(){return new o(1,1,1)}static get up(){return new o(0,1,0)}static get down(){return new o(0,-1,0)}static get right(){return new o(1,0,0)}static get left(){return new o(-1,0,0)}static get forward(){return new o(0,0,1)}static get back(){return new o(0,0,-1)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}static copy(t,e){return e=e||new o(0,0,0),e.x=t.x,e.y=t.y,e.z=t.z,e}static transform(t,e,r){r=r||new o(0,0,0);let n=t.x*e[0]+t.y*e[4]+t.z*e[8]+e[12],i=t.x*e[1]+t.y*e[5]+t.z*e[9]+e[13],a=t.x*e[2]+t.y*e[6]+t.z*e[10]+e[14],c=t.x*e[3]+t.y*e[7]+t.z*e[11]+e[15];return r.x=n/c,r.y=i/c,r.z=a/c,r}static cross(t,e,r){r=r||new o(0,0,0);let n=t.z*e.x-t.x*e.z,i=t.x*e.y-t.y*e.x;return r.x=t.y*e.z-t.z*e.y,r.y=n,r.z=i,r}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static equals(t,e){return t.x!==e.x||t.y!==e.y||t.z!==e.z}static sub(t,e,r){return r=r||new o(0,0,0),r.x=t.x-e.x,r.y=t.y-e.y,r.z=t.z-e.z,r}static add(t,e,r){return r=r||new o(0,0,0),r.x=t.x+e.x,r.y=t.y+e.y,r.z=t.z+e.z,r}static scale(t,e,r){return r=r||new o(0,0,0),r.x=t.x*e,r.y=t.y*e,r.z=t.z*e,r}static normalize(t,e){e=e||new o(0,0,0);let r=1/t.magnitude;return e.x=t.x*r,e.y=t.y*r,e.z=t.z*r,e}static f32(t,e){return e=e||new Float32Array(3),e[0]=t.x,e[1]=t.y,e[2]=t.z,e}},m=class o{static zero(t){return t=t||new Float32Array(16),t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=0,t}static identity(t){return t=o.zero(t),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}static setScalar(t,e){return e=e||new Float32Array(16),o.identity(e),e[0]=t.x,e[5]=t.y,e[10]=t.z,e}static lookAt(t,e,r=s.up,n){n=n||o.identity();let i=s.sub(e,t);s.normalize(i,i);let a=s.cross(r,i);s.normalize(a,a);let c=s.cross(i,a);return s.normalize(c,c),n[0]=a.x,n[1]=c.x,n[2]=i.x,n[4]=a.y,n[5]=c.y,n[6]=i.y,n[8]=a.z,n[9]=c.z,n[10]=i.z,n[12]=-s.dot(a,t),n[13]=-s.dot(c,t),n[14]=-s.dot(i,t),n}static perspectiveFovLH(t,e,r,n,i){i=i||o.identity();let a=1/Math.tan(t*.5);return i[0]=a/e,i[5]=a,i[10]=-n/(r-n),i[11]=1,i[14]=r*n/(r-n),i[15]=0,i}static rotate(t,e){return o.rotateX(t,e.x),o.rotateY(t,e.y),o.rotateZ(t,e.z),t}static rotateX(t,e){let r=B(e),n=Math.sin(r),i=Math.cos(r);return o.multiply(t,new Float32Array([1,0,0,0,0,i,n,0,0,-n,i,0,0,0,0,1]),t),t}static rotateY(t,e){let r=B(e),n=Math.sin(r),i=Math.cos(r);return o.multiply(t,new Float32Array([i,0,-n,0,0,1,0,0,n,0,i,0,0,0,0,1]),t)}static rotateZ(t,e){let r=B(e),n=Math.sin(r),i=Math.cos(r);return o.multiply(t,new Float32Array([i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1]),t)}static translation(t,e){return e=e||o.identity(),e[12]=t.x,e[13]=t.y,e[14]=t.z,e}static multiply(t,e,r){r=r||new Float32Array(16);let n=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],i=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],a=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],c=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15];return r[0]=n,r[1]=i,r[2]=a,r[3]=c,n=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],i=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],a=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],c=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],r[4]=n,r[5]=i,r[6]=a,r[7]=c,n=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],i=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],a=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],c=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],r[8]=n,r[9]=i,r[10]=a,r[11]=c,n=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],i=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],a=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],c=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],r[12]=n,r[13]=i,r[14]=a,r[15]=c,r}static invert(t,e){e=e||new Float32Array(16);let r=t[0],n=t[1],i=t[2],a=t[3],c=t[4],y=t[5],h=t[6],A=t[7],p=t[8],F=t[9],L=t[10],b=t[11],w=t[12],U=t[13],g=t[14],z=t[15],f=L*z-b*g,R=F*z-b*U,C=F*g-L*U,G=p*z-b*w,I=p*g-L*w,W=p*U-F*w,N=y*f-h*R+A*C,k=-(c*f-h*G+A*I),H=c*R-y*G+A*W,Y=-(c*C-y*I+h*W),l=1/(r*N+n*k+i*H+a*Y),K=h*z-A*g,q=y*z-A*U,X=y*g-h*U,Z=c*z-A*w,J=c*g-h*w,Q=c*U-y*w,$=h*b-A*L,tt=y*b-A*F,et=y*L-h*F,rt=c*b-A*p,ot=c*L-h*p,nt=c*F-y*p;return e[0]=N*l,t[4]=k*l,e[8]=H*l,t[12]=Y*l,e[1]=-(n*f-i*R+a*C)*l,e[5]=(r*f-i*G+a*I)*l,e[9]=-(r*R-n*G+a*W)*l,e[13]=(r*C-n*I+i*W)*l,e[2]=(n*K-i*q+a*X)*l,e[6]=-(r*K-i*Z+a*J)*l,e[10]=(r*q-n*Z+a*Q)*l,e[14]=-(r*X-n*J+i*Q)*l,e[3]=-(n*$-i*tt+a*et)*l,e[7]=(r*$-i*rt+a*ot)*l,e[11]=-(r*tt-n*rt+a*nt)*l,e[15]=(r*et-n*ot+i*nt)*l,e}static copy(t,e){return t===e||(e=e||new Float32Array(16),e.set(t)),e}static transpose(t,e){if(e=e||new Float32Array(16),e===t){let f;return f=t[1],t[1]=t[4],t[4]=f,f=t[2],t[2]=t[8],t[8]=f,f=t[3],t[3]=t[12],t[12]=f,f=t[6],t[6]=t[9],t[9]=f,f=t[7],t[7]=t[13],t[13]=f,f=t[11],t[11]=t[14],t[14]=f,e}let r=t[0],n=t[1],i=t[2],a=t[3],c=t[4],y=t[5],h=t[6],A=t[7],p=t[8],F=t[9],L=t[10],b=t[11],w=t[12],U=t[13],g=t[14],z=t[15];return e[0]=r,e[1]=c,e[2]=p,e[3]=w,e[4]=n,e[5]=y,e[6]=F,e[7]=U,e[8]=i,e[9]=h,e[10]=L,e[11]=g,e[12]=a,e[13]=A,e[14]=b,e[15]=z,e}};function B(o){return o*(Math.PI/180)}var T=class{needsUpdate=!0;worldMatrix=m.identity();viewMatrix=m.identity();position=s.zero;rotation=s.zero;scale=s.one;mesh;name;constructor(t,e,r){this.name=t,e&&this.setPosition(e),r&&this.setRotation(r)}get forward(){return s.transform(s.forward,m.rotate(m.identity(),this.rotation))}setMesh(t){return this.mesh=t,this}setPosition(t,e,r){if(this.needsUpdate=!0,t instanceof s)return s.copy(t,this.position),this;if(typeof e=="number"&&typeof r=="number")return this.position.x=t,this.position.y=e,this.position.z=r,this;throw new Error("Invalid arguments")}setRotation(t,e,r){if(this.needsUpdate=!0,t instanceof s)return s.copy(t,this.rotation),this;if(typeof e=="number"&&typeof r=="number")return this.rotation.x=t%360,this.rotation.y=e%360,this.rotation.z=r%360,this;throw new Error("Invalid arguments")}rotate(t,e,r){if(this.needsUpdate=!0,t instanceof s)return s.add(this.rotation,t,this.rotation),this;if(typeof e=="number"&&typeof r=="number")return this.rotation.x=(this.rotation.x+t)%360,this.rotation.y=(this.rotation.y+e)%360,this.rotation.z=(this.rotation.z+r)%360,this;throw new Error("Invalid arguments")}translate(t,e,r){if(this.needsUpdate=!0,t instanceof s)return s.add(this.position,t,this.position),this;if(typeof e=="number"&&typeof r=="number")return this.position.x=this.position.x+t,this.position.y=this.position.y+e,this.position.z=this.position.z+r,this;throw new Error("Invalid arguments")}getWorldMatrix(){return this.needsUpdate&&(m.setScalar(this.scale,this.worldMatrix),m.rotate(this.worldMatrix,this.rotation),m.multiply(this.worldMatrix,m.translation(this.position),this.worldMatrix),this.needsUpdate=!1),this.worldMatrix}getViewMatrix(){return this.needsUpdate&&(m.lookAt(this.position,s.add(this.position,this.forward),void 0,this.viewMatrix),this.needsUpdate=!1),this.viewMatrix}};var S=class extends T{projectionUpdated=!0;projectionMatrix=m.identity();fov;near;far;constructor(t,e,r){super(t,e,r),this.fov=.9,this.near=.1,this.far=2e4,globalThis.addEventListener("resize",()=>this.projectionUpdated=!0)}get aspect(){return globalThis.innerWidth/globalThis.innerHeight}getProjectionMatrix(){return this.projectionUpdated&&(m.perspectiveFovLH(this.fov,this.aspect,this.near,this.far,this.projectionMatrix),this.projectionUpdated=!1),this.projectionMatrix}};var x=class{static createProgramInfo(t,e=se,r=ce){let n=mt(t,e,r),i=yt(t,n);return{program:n,uniformInfo:i,attributeInfo:{}}}static setUniforms(t,e){for(let[r,n]of Object.entries(e)){if(!(r in t.uniformInfo)){console.error("Invalid uniform: "+r);continue}t.uniformInfo[r].setter(n)}}static getContext(t){let e=t.getContext("webgl2");if(!e)throw new Error("Failed to get WebGL2 context of canvas");return e}static VAO(t,e,r){let n=t.createVertexArray();if(!n)throw new Error("Unable to create vao");return t.bindVertexArray(n),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,r.vertices,t.STATIC_DRAW),O(t,e,"a_position",3,t.FLOAT,!1,3*4,0),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,r.normals,t.STATIC_DRAW),O(t,e,"a_normal",3,t.FLOAT,!1,3*4,0),r.uvs?.length&&(t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,r.uvs,t.STATIC_DRAW),O(t,e,"a_texCoord",2,t.FLOAT,!0,2*4,0)),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r.triangles,t.STATIC_DRAW),n}};function O(o,t,e,r,n,i,a,c){let y=o.getAttribLocation(t,e);o.vertexAttribPointer(y,r,n,i,a,c),o.enableVertexAttribArray(y)}function mt(o,t,e){let r=o.createProgram();if(!r)throw new Error("Unable to create Program");return it(o,r,t,Ft),it(o,r,e,pt),o.linkProgram(r),o.validateProgram(r),o.getProgramParameter(r,At)||console.error(`Program linking failed:

`,o.getProgramInfoLog(r)),o.getProgramParameter(r,xt)||console.error(`Program validation failed:

`,o.getProgramInfoLog(r)),o.enable(o.DEPTH_TEST),o.enable(o.CULL_FACE),o.frontFace(o.CW),o.cullFace(o.BACK),o.useProgram(r),r}function it(o,t,e,r){let n=o.createShader(r);if(!n)throw new Error("Unable to create Shader");if(o.shaderSource(n,e),o.compileShader(n),!o.getShaderParameter(n,ht))throw new Error(`Unable to compile Shader.

`+o.getShaderInfoLog(n));return o.attachShader(t,n),n}function yt(o,t){let e={},r=o.getProgramParameter(t,o.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){let i=o.getActiveUniform(t,n);if(!i)continue;let a=o.getUniformLocation(t,i.name);e[i.name]={location:o.getUniformLocation(t,i.name),setter:u[i.type].setter(o,a)}}return e}var ht=35713,At=35714,xt=35715,pt=35632,Ft=35633,Lt=5126,bt=35664,wt=35665,Ut=35666,gt=5124,zt=35667,Tt=35668,Vt=35669,vt=35670,St=35671,Mt=35672,Rt=35673,Ct=35674,Gt=35685,It=35686,Wt=35675,Et=35687,Pt=35688,_t=35676,Bt=35689,Ot=35690,dt=5125,Dt=36294,jt=36295,Nt=36296,u={};u[Lt]={type:Float32Array,size:4,setter:kt,cols:1};u[bt]={type:Float32Array,size:8,setter:Ht,cols:2};u[wt]={type:Float32Array,size:12,setter:Yt,cols:3};u[Ut]={type:Float32Array,size:16,setter:Kt,cols:4};u[gt]={type:Int32Array,size:4,setter:at,cols:1};u[zt]={type:Int32Array,size:8,setter:st,cols:2};u[Tt]={type:Int32Array,size:12,setter:ct,cols:3};u[Vt]={type:Int32Array,size:16,setter:ut,cols:4};u[dt]={type:Uint32Array,size:4,setter:qt,cols:1};u[Dt]={type:Uint32Array,size:8,setter:Xt,cols:2};u[jt]={type:Uint32Array,size:12,setter:Zt,cols:3};u[Nt]={type:Uint32Array,size:16,setter:Jt,cols:4};u[vt]={type:Uint32Array,size:4,setter:at,cols:1};u[St]={type:Uint32Array,size:8,setter:st,cols:2};u[Mt]={type:Uint32Array,size:12,setter:ct,cols:3};u[Rt]={type:Uint32Array,size:16,setter:ut,cols:4};u[Ct]={type:Float32Array,size:32,setter:Qt,rows:2,cols:2};u[Wt]={type:Float32Array,size:48,setter:$t,rows:3,cols:3};u[_t]={type:Float32Array,size:64,setter:te,rows:4,cols:4};u[Gt]={type:Float32Array,size:32,setter:ee,rows:2,cols:3};u[It]={type:Float32Array,size:32,setter:oe,rows:2,cols:4};u[Et]={type:Float32Array,size:48,setter:re,rows:3,cols:2};u[Pt]={type:Float32Array,size:48,setter:ie,rows:3,cols:4};u[Bt]={type:Float32Array,size:64,setter:ne,rows:4,cols:2};u[Ot]={type:Float32Array,size:64,setter:ae,rows:4,cols:3};function kt(o,t){return function(e){o.uniform1fv(t,e)}}function Ht(o,t){return function(e){o.uniform2fv(t,e)}}function Yt(o,t){return function(e){o.uniform3fv(t,e)}}function Kt(o,t){return function(e){o.uniform4fv(t,e)}}function at(o,t){return function(e){o.uniform1iv(t,e)}}function st(o,t){return function(e){o.uniform2iv(t,e)}}function ct(o,t){return function(e){o.uniform3iv(t,e)}}function ut(o,t){return function(e){o.uniform4iv(t,e)}}function qt(o,t){return function(e){o.uniform1uiv(t,e)}}function Xt(o,t){return function(e){o.uniform2uiv(t,e)}}function Zt(o,t){return function(e){o.uniform3uiv(t,e)}}function Jt(o,t){return function(e){o.uniform4uiv(t,e)}}function Qt(o,t){return function(e){o.uniformMatrix2fv(t,!1,e)}}function $t(o,t){return function(e){o.uniformMatrix3fv(t,!1,e)}}function te(o,t){return function(e){o.uniformMatrix4fv(t,!1,e)}}function ee(o,t){return function(e){o.uniformMatrix2x3fv(t,!1,e)}}function re(o,t){return function(e){o.uniformMatrix3x2fv(t,!1,e)}}function oe(o,t){return function(e){o.uniformMatrix2x4fv(t,!1,e)}}function ne(o,t){return function(e){o.uniformMatrix4x2fv(t,!1,e)}}function ie(o,t){return function(e){o.uniformMatrix3x4fv(t,!1,e)}}function ae(o,t){return function(e){o.uniformMatrix4x3fv(t,!1,e)}}var se=`#version 300 es
    in vec3 a_position;
    in vec3 a_normal;

    uniform mat4 u_world;
    uniform mat4 u_view;
    uniform mat4 u_proj;

    out vec3 v_normal;

    void main() {
        v_normal = a_normal;
        gl_Position = u_proj * u_view * u_world * vec4(a_position, 1.0);
    }
`,ce=`#version 300 es
    precision mediump float;

    in vec3 v_normal;

    out vec4 f_color;

    void main() {
        vec3 normal = normalize(v_normal);
        f_color = vec4(normal, 1.0); 
    }
`;var E=class{gl;canvas;programInfo;constructor(t){this.canvas=t,this.gl=x.getContext(t),this.programInfo=x.createProgramInfo(this.gl),this.gl.clearColor(.3,.6,.8,1),this.resizeCanvas(),globalThis.addEventListener("resize",()=>this.resizeCanvas)}render(t,e){this.gl.clear(this.gl.COLOR_BUFFER_BIT),x.setUniforms(this.programInfo,{u_view:e.getViewMatrix(),u_proj:e.getProjectionMatrix()});for(let r of t.objects)r.mesh&&(r.mesh.vao||(r.mesh.vao=x.VAO(this.gl,this.programInfo.program,r.mesh)),x.setUniforms(this.programInfo,{u_world:r.getWorldMatrix()}),this.gl.bindVertexArray(r.mesh.vao),this.gl.drawElements(this.gl.TRIANGLES,r.mesh.triangles.length,this.gl.UNSIGNED_SHORT,0))}resizeCanvas(t=1){this.gl.canvas.width=globalThis.innerWidth*t,this.gl.canvas.height=globalThis.innerHeight*t,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}};var v=class o{vertices;normals;triangles;uvs;vao;constructor(t,e,r){this.vertices=t,this.normals=e,this.triangles=r}static Cube(){let t=new Float32Array([-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5]),e=new Float32Array([-1,-1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,1,-1,1,1,1,-1,1,1,1,1]),r=new Uint16Array([0,1,3,0,3,2,2,3,7,2,7,6,6,7,5,6,5,4,4,5,1,4,1,0,1,5,7,1,7,3,4,0,2,4,2,6]);return new o(t,e,r)}static Pyramid(){let t=new Float32Array([0,.5,0,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5]),e=new Float32Array([0,1,0,-1,0,1,1,0,1,1,0,-1,-1,0,-1]),r=new Uint16Array([0,1,2,0,2,3,0,3,4,0,4,1,1,4,2,2,4,3]);return new o(t,e,r)}};var M=class{objects=[];constructor(...t){for(let e of t)this.add(e)}add(t){this.objects.push(t)}};var P=class{movement;rotation;constructor(){this.movement=s.zero,this.rotation=s.zero,document.addEventListener("keydown",t=>this.onKey(t)),document.addEventListener("keyup",t=>this.onKey(t))}onKey(t){let e=t.type==="keydown";switch(t.key){case"w":case"W":this.movement.z=e?1:0;break;case"s":case"S":this.movement.z=e?-1:0;break;case"a":case"A":this.movement.x=e?-1:0;break;case"d":case"D":this.movement.x=e?1:0;break;case"ArrowUp":this.rotation.x=e?1:0;break;case"ArrowDown":this.rotation.x=e?-1:0;break;case"ArrowLeft":this.rotation.y=e?-1:0;break;case"ArrowRight":this.rotation.y=e?1:0;break}}};var _=class{autoStart;startTime;oldTime;elapsedTime;running;constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};var ue=new E(document.querySelector("canvas")),d=new S("main").setPosition(0,0,-6),D=new T("cube").setPosition(1,0,0).setMesh(v.Cube()),j=new T("pyramid",new s(-1,0,0)).setPosition(-1,0,0).setMesh(v.Pyramid()),fe=new M(D,j),ft=new P,le=new _,V;function lt(){V=le.getDelta(),D.rotate(0,100*V,0),j.rotate(0,100*-V,0),D.setPosition(1,Math.sin(10*V),0),j.setPosition(-1,Math.cos(10*V),0),d.rotate(s.scale(ft.rotation,V*80)),d.translate(s.scale(ft.movement,V*10)),ue.render(fe,d),requestAnimationFrame(lt)}requestAnimationFrame(lt);
//# sourceMappingURL=index.js.map
